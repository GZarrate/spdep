<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Saddlepoint approximation of local Moran's Ii tests — localmoran.sad • spdep</title>

<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script>

<!-- sticky kit -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>



<meta property="og:title" content="Saddlepoint approximation of local Moran's Ii tests — localmoran.sad" />

<meta property="og:description" content="The function implements Tiefelsdorf's application of the Saddlepoint
approximation to local Moran's Ii's reference distribution. If the model
object is of class &quot;lm&quot;, global independence is assumed; if of class
&quot;sarlm&quot;, global dependence is assumed to be represented by the spatial
parameter of that model. Tests are reported separately for each zone
selected, and may be summarised using summary.localmoransad.
Values of local Moran's Ii agree with those from localmoran(),
but in that function, the standard deviate - here the Saddlepoint
approximation - is based on the randomisation assumption." />
<meta name="twitter:card" content="summary" />



<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">spdep</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.8.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/nb_igraph.html">Spatial weights objects as sparse matrices and graphs</a>
    </li>
    <li>
      <a href="../articles/nb_sf.html">Creating Neighbours using sf objects</a>
    </li>
  </ul>
</li>
      </ul>
      
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/r-spatial/spdep">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      
      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Saddlepoint approximation of local Moran's Ii tests</h1>
    
    <div class="hidden name"><code>localmoran.sad.Rd</code></div>
    </div>

    <div class="ref-description">
    
    <p>The function implements Tiefelsdorf's application of the Saddlepoint
approximation to local Moran's Ii's reference distribution. If the model
object is of class "lm", global independence is assumed; if of class
"sarlm", global dependence is assumed to be represented by the spatial
parameter of that model. Tests are reported separately for each zone
selected, and may be summarised using <code>summary.localmoransad</code>.
Values of local Moran's Ii agree with those from <code><a href='localmoran.html'>localmoran()</a></code>,
but in that function, the standard deviate - here the Saddlepoint
approximation - is based on the randomisation assumption.</p>
    
    </div>

    <pre class="usage">localmoran.sad(model, select, nb, glist=NULL, style="W",
 zero.policy=NULL, alternative="greater", spChk=NULL,
 resfun=weighted.residuals, save.Vi=FALSE,
 tol = .Machine$double.eps^0.5, maxiter = 1000, tol.bounds=0.0001,
 save.M=FALSE, Omega = NULL)
<!-- %as.data.frame.localmoransad(x, row.names=NULL, optional=FALSE)  -->
# S3 method for localmoransad
print(x, ...)
# S3 method for localmoransad
summary(object, ...)
# S3 method for summary.localmoransad
print(x, ...)
listw2star(listw, ireg, style, n, D, a, zero.policy=NULL)</pre>
    
    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>model</th>
      <td><p>an object of class <code>lm</code> returned by <code>lm</code> (assuming no global spatial autocorrelation), or an object of class <code>sarlm</code> returned by a spatial simultaneous autoregressive model fit (assuming global spatial autocorrelation represented by the model spatial coefficient); weights may be specified in the <code>lm</code> fit, but offsets should not be used</p></td>
    </tr>
    <tr>
      <th>select</th>
      <td><p>an integer vector of the id. numbers of zones to be tested; if missing, all zones</p></td>
    </tr>
    <tr>
      <th>nb</th>
      <td><p>a list of neighbours of class <code>nb</code></p></td>
    </tr>
    <tr>
      <th>glist</th>
      <td><p>a list of general weights corresponding to neighbours</p></td>
    </tr>
    <tr>
      <th>style</th>
      <td><p>can take values W, B, C, and S</p></td>
    </tr>
    <tr>
      <th>zero.policy</th>
      <td><p>default NULL, use global option value; if TRUE assign zero to the lagged value of zones without
neighbours, if FALSE assign NA</p></td>
    </tr>
    <tr>
      <th>alternative</th>
      <td><p>a character string specifying the alternative hypothesis,
must be one of greater (default), less or two.sided.</p></td>
    </tr>
    <tr>
      <th>spChk</th>
      <td><p>should the data vector names be checked against the spatial objects for identity integrity, TRUE, or FALSE, default NULL to use <code><a href='set.spChkOption.html'>get.spChkOption()</a></code></p></td>
    </tr>
    <tr>
      <th>resfun</th>
      <td><p>default: weighted.residuals; the function to be used to extract residuals from the <code>lm</code> object, may be <code>residuals</code>, <code>weighted.residuals</code>, <code>rstandard</code>, or <code>rstudent</code></p></td>
    </tr>
    <tr>
      <th>save.Vi</th>
      <td><p>if TRUE, return the star-shaped weights lists for each zone 
tested</p></td>
    </tr>
    <tr>
      <th>tol</th>
      <td><p>the desired accuracy (convergence tolerance) for <code>uniroot</code></p></td>
    </tr>
    <tr>
      <th>maxiter</th>
      <td><p>the maximum number of iterations for <code>uniroot</code></p></td>
    </tr>
    <tr>
      <th>tol.bounds</th>
      <td><p>offset from bounds for <code>uniroot</code></p></td>
    </tr>
    <tr>
      <th>save.M</th>
      <td><p>if TRUE, save a list of left and right M products in a list for the conditional tests, or a list of the regression model matrix components</p></td>
    </tr>
    <tr>
      <th>Omega</th>
      <td><p>A SAR process matrix may be passed in to test an alternative hypothesis, for example <code>Omega &lt;- invIrW(listw, rho=0.1); Omega &lt;- tcrossprod(Omega)</code>, <code><a href='https://www.rdocumentation.org/packages/base/topics/chol'>chol()</a></code> is taken internally</p></td>
    </tr>
    <tr>
      <th>x</th>
      <td><p>object to be printed</p></td>
    </tr>
    <tr>
      <th>object</th>
      <td><p>object to be summarised</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>arguments to be passed through</p></td>
    </tr>
    <tr>
      <th>listw</th>
      <td><p>a <code>listw</code> object created for example by <code>nb2listw</code></p></td>
    </tr>
    <tr>
      <th>ireg</th>
      <td><p>a zone number</p></td>
    </tr>
    <tr>
      <th>n</th>
      <td><p>internal value depending on listw and style</p></td>
    </tr>
    <tr>
      <th>D</th>
      <td><p>internal value depending on listw and style</p></td>
    </tr>
    <tr>
      <th>a</th>
      <td><p>internal value depending on listw and style</p></td>
    </tr>
    </table>
    
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>The function implements the analytical eigenvalue calculation together with
trace shortcuts given or suggested in Tiefelsdorf (2002), partly
following remarks by J. Keith Ord, and uses the
Saddlepoint analytical solution from Tiefelsdorf's SPSS code.</p>
<p>If a histogram of the probability values of the saddlepoint estimate
for the assumption of global independence is not approximately flat,
the assumption is probably unjustified, and re-estimation with global
dependence is recommended.</p>
<p>No n by n matrices are needed at any point for the test assuming no global
dependence, the star-shaped weights matrices being handled as listw
lists. When the test is made on residuals from a spatial regression,
taking a global process into account. n by n matrices are necessary,
and memory constraints may be reached for large lattices.</p>
    
    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>A list with class <code>localmoransad</code> containing "select" lists, each with
 class <code>moransad</code> with the following components:</p>
<dt>statistic</dt><dd><p>the value of the saddlepoint approximation of the
 standard deviate of local Moran's Ii.</p></dd>
  <dt>p.value</dt><dd><p>the p-value of the test.</p></dd>
  <dt>estimate</dt><dd><p>the value of the observed local Moran's Ii.</p></dd>
  <dt>alternative</dt><dd><p>a character string describing the alternative hypothesis.</p></dd>
  <dt>method</dt><dd><p>a character string giving the method used.</p></dd>
  <dt>data.name</dt><dd><p>a character string giving the name(s) of the data.</p></dd>
  <dt>internal1</dt><dd><p>Saddlepoint omega, r and u</p></dd>
  <dt>df</dt><dd><p>degrees of freedom</p></dd>
  <dt>tau</dt><dd><p>maximum and minimum analytical eigenvalues</p></dd>
  <dt>i</dt><dd><p>zone tested</p></dd>

    
    <h2 class="hasAnchor" id="references"><a class="anchor" href="#references"></a>References</h2>

    <p>Tiefelsdorf, M. 2002 The Saddlepoint approximation of Moran's I 
and local Moran's Ii reference distributions and their numerical evaluation. 
Geographical Analysis, 34, pp. 187--206.</p>
    
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p><code><a href='localmoran.html'>localmoran</a></code>, <code><a href='lm.morantest.html'>lm.morantest</a></code>,
 <code><a href='lm.morantest.sad.html'>lm.morantest.sad</a></code>, <code><a href='errorsarlm.html'>errorsarlm</a></code></p></div>
    

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='kw'>if</span> (<span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/library'>require</a></span>(<span class='no'>rgdal</span>, <span class='kw'>quietly</span><span class='kw'>=</span><span class='fl'>TRUE</span>)) {
<span class='no'>eire</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/rgdal/topics/readOGR'>readOGR</a></span>(<span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/system.file'>system.file</a></span>(<span class='st'>"shapes/eire.shp"</span>, <span class='kw'>package</span><span class='kw'>=</span><span class='st'>"spData"</span>)[<span class='fl'>1</span>])
<span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/row.names'>row.names</a></span>(<span class='no'>eire</span>) <span class='kw'>&lt;-</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/character'>as.character</a></span>(<span class='no'>eire</span>$<span class='no'>names</span>)
<span class='fu'>proj4string</span>(<span class='no'>eire</span>) <span class='kw'>&lt;-</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/rgdal/topics/CRS-class'>CRS</a></span>(<span class='st'>"+proj=utm +zone=30 +ellps=airy +units=km"</span>)
<span class='no'>eire.nb</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='poly2nb.html'>poly2nb</a></span>(<span class='no'>eire</span>)
<span class='no'>lw</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='nb2listw.html'>nb2listw</a></span>(<span class='no'>eire.nb</span>)
<span class='no'>e.lm</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/stats/topics/lm'>lm</a></span>(<span class='no'>OWNCONS</span> ~ <span class='no'>ROADACC</span>, <span class='kw'>data</span><span class='kw'>=</span><span class='no'>eire</span>)
<span class='no'>e.locmor</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/summary'>summary</a></span>(<span class='fu'>localmoran.sad</span>(<span class='no'>e.lm</span>, <span class='kw'>nb</span><span class='kw'>=</span><span class='no'>eire.nb</span>))
<span class='no'>e.locmor</span>
<span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/mean'>mean</a></span>(<span class='no'>e.locmor</span>[,<span class='fl'>1</span>])
<span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/sum'>sum</a></span>(<span class='no'>e.locmor</span>[,<span class='fl'>1</span>])/<span class='fu'><a href='spweights.constants.html'>Szero</a></span>(<span class='no'>lw</span>)
<span class='fu'><a href='lm.morantest.html'>lm.morantest</a></span>(<span class='no'>e.lm</span>, <span class='no'>lw</span>)
<span class='co'># note equality for mean() only when the sum of weights equals</span>
<span class='co'># the number of observations (thanks to Juergen Symanzik)</span>
<span class='fu'><a href='https://www.rdocumentation.org/packages/graphics/topics/hist'>hist</a></span>(<span class='no'>e.locmor</span>[,<span class='st'>"Pr. (Sad)"</span>])
<span class='no'>e.wlm</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/stats/topics/lm'>lm</a></span>(<span class='no'>OWNCONS</span> ~ <span class='no'>ROADACC</span>, <span class='kw'>data</span><span class='kw'>=</span><span class='no'>eire</span>, <span class='kw'>weights</span><span class='kw'>=</span><span class='no'>RETSALE</span>)
<span class='no'>e.locmorw1</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/summary'>summary</a></span>(<span class='fu'>localmoran.sad</span>(<span class='no'>e.wlm</span>, <span class='kw'>nb</span><span class='kw'>=</span><span class='no'>eire.nb</span>, <span class='kw'>resfun</span><span class='kw'>=</span><span class='no'>weighted.residuals</span>))
<span class='no'>e.locmorw1</span>
<span class='no'>e.locmorw2</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/summary'>summary</a></span>(<span class='fu'>localmoran.sad</span>(<span class='no'>e.wlm</span>, <span class='kw'>nb</span><span class='kw'>=</span><span class='no'>eire.nb</span>, <span class='kw'>resfun</span><span class='kw'>=</span><span class='no'>rstudent</span>))
<span class='no'>e.locmorw2</span>
<span class='no'>e.errorsar</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='errorsarlm.html'>errorsarlm</a></span>(<span class='no'>OWNCONS</span> ~ <span class='no'>ROADACC</span>, <span class='kw'>data</span><span class='kw'>=</span><span class='no'>eire</span>,
  <span class='kw'>listw</span><span class='kw'>=</span><span class='no'>lw</span>)
<span class='no'>e.errorsar</span>
<span class='no'>lm.target</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/stats/topics/lm'>lm</a></span>(<span class='no'>e.errorsar</span>$<span class='no'>tary</span> ~ <span class='no'>e.errorsar</span>$<span class='no'>tarX</span> - <span class='fl'>1</span>)
<span class='no'>Omega</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/crossprod'>tcrossprod</a></span>(<span class='fu'><a href='invIrM.html'>invIrW</a></span>(<span class='no'>lw</span>, <span class='kw'>rho</span><span class='kw'>=</span><span class='no'>e.errorsar</span>$<span class='no'>lambda</span>))
<span class='no'>e.clocmor</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/summary'>summary</a></span>(<span class='fu'>localmoran.sad</span>(<span class='no'>lm.target</span>, <span class='kw'>nb</span><span class='kw'>=</span><span class='no'>eire.nb</span>, <span class='kw'>Omega</span><span class='kw'>=</span><span class='no'>Omega</span>))
<span class='no'>e.clocmor</span>
<span class='fu'><a href='https://www.rdocumentation.org/packages/graphics/topics/hist'>hist</a></span>(<span class='no'>e.clocmor</span>[,<span class='st'>"Pr. (Sad)"</span>])
}</div><div class='output co'>#&gt; OGR data source with driver: ESRI Shapefile 
#&gt; Source: "/home/rsb/lib/r_libs/spData/shapes/eire.shp", layer: "eire"
#&gt; with 26 features
#&gt; It has 10 fields</div><div class='img'><img src='localmoran.sad-1.png' alt='' width='700' height='433' /></div><div class='img'><img src='localmoran.sad-2.png' alt='' width='700' height='433' /></div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#arguments">Arguments</a></li>
      
      <li><a href="#details">Details</a></li>

      <li><a href="#value">Value</a></li>

      <li><a href="#references">References</a></li>

      <li><a href="#see-also">See also</a></li>
      
      <li><a href="#examples">Examples</a></li>
    </ul>

    <h2>Author</h2>
    <p>Roger Bivand <a href='mailto:Roger.Bivand@nhh.no'>Roger.Bivand@nhh.no</a></p>
  </div>
</div>

      <footer>
      <div class="copyright">
  <p>Developed by Roger Bivand.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
   </div>

  

  </body>
</html>

