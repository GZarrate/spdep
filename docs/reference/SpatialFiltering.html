<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Semi-parametric spatial filtering — SpatialFiltering • spdep</title>

<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script>

<!-- sticky kit -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>



<meta property="og:title" content="Semi-parametric spatial filtering — SpatialFiltering" />

<meta property="og:description" content="The function selects eigenvectors in a semi-parametric spatial filtering approach to removing spatial dependence from linear models. Selection is by brute force by finding the single eigenvector reducing the standard variate of Moran's I for regression residuals most, and continuing until no candidate eigenvector reduces the value by more than tol. It returns a summary table from the selection process and a matrix of selected eigenvectors for the specified model." />
<meta name="twitter:card" content="summary" />



<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">spdep</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.8.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/CO69.html">“The Problem of Spatial Autocorrelation:” forty years on</a>
    </li>
    <li>
      <a href="../articles/SpatialFiltering.html">Moran Eigenvectors</a>
    </li>
    <li>
      <a href="../articles/nb_igraph.html">Spatial weights objects as sparse matrices and graphs</a>
    </li>
    <li>
      <a href="../articles/nb_sf.html">Creating Neighbours using sf objects</a>
    </li>
    <li>
      <a href="../articles/sids.html">Introduction to the North Carolina SIDS data set (revised)</a>
    </li>
  </ul>
</li>
      </ul>
      
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/r-spatial/spdep">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      
      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Semi-parametric spatial filtering</h1>
    
    <div class="hidden name"><code>SpatialFiltering.Rd</code></div>
    </div>

    <div class="ref-description">
    
    <p>The function selects eigenvectors in a semi-parametric spatial filtering approach to removing spatial dependence from linear models. Selection is by brute force by finding the single eigenvector reducing the standard variate of Moran's I for regression residuals most, and continuing until no candidate eigenvector reduces the value by more than <code>tol</code>. It returns a summary table from the selection process and a matrix of selected eigenvectors for the specified model.</p>
    
    </div>

    <pre class="usage"><span class='fu'>SpatialFiltering</span>(<span class='no'>formula</span>, <span class='no'>lagformula</span>, <span class='kw'>data</span> <span class='kw'>=</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/list'>list</a></span>(), <span class='no'>nb</span>, <span class='kw'>glist</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>style</span> <span class='kw'>=</span> <span class='st'>"C"</span>,
 <span class='kw'>zero.policy</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>tol</span> <span class='kw'>=</span> <span class='fl'>0.1</span>, <span class='kw'>zerovalue</span> <span class='kw'>=</span> <span class='fl'>1e-04</span>, <span class='kw'>ExactEV</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>,
 <span class='kw'>symmetric</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>, <span class='kw'>alpha</span><span class='kw'>=</span><span class='kw'>NULL</span>, <span class='kw'>alternative</span><span class='kw'>=</span><span class='st'>"two.sided"</span>, <span class='kw'>verbose</span><span class='kw'>=</span><span class='kw'>NULL</span>)</pre>
    
    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>formula</th>
      <td><p>a symbolic description of the model to be fit, assuming a spatial error representation; when lagformula is given, it should include only the response and the intercept term</p></td>
    </tr>
    <tr>
      <th>lagformula</th>
      <td><p>An extra one-sided formula to be used when a spatial lag representation is desired; the intercept is excluded within the function if present because it is part of the formula argument, but excluding it explicitly in the lagformula argument in the presence of factors generates a collinear model matrix</p></td>
    </tr>
    <tr>
      <th>data</th>
      <td><p>an optional data frame containing the variables in the model</p></td>
    </tr>
    <tr>
      <th>nb</th>
      <td><p>an object of class <code>nb</code></p></td>
    </tr>
    <tr>
      <th>glist</th>
      <td><p>list of general weights corresponding to neighbours</p></td>
    </tr>
    <tr>
      <th>style</th>
      <td><p><code>style</code> can take values W, B, C, U, and S</p></td>
    </tr>
    <tr>
      <th>zero.policy</th>
      <td><p>default NULL, use global option value; if FALSE stop with error for any empty neighbour sets, if TRUE permit the weights list to be formed with zero-length weights vectors</p></td>
    </tr>
    <tr>
      <th>tol</th>
      <td><p>tolerance value for convergence of spatial filtering</p></td>
    </tr>
    <tr>
      <th>zerovalue</th>
      <td><p>eigenvectors with eigenvalues of an absolute value smaller than zerovalue will be excluded in eigenvector search</p></td>
    </tr>
    <tr>
      <th>ExactEV</th>
      <td><p>Set ExactEV=TRUE to use exact expectations and variances rather than the expectation and variance of Moran's I from the previous iteration, default FALSE</p></td>
    </tr>
    <tr>
      <th>symmetric</th>
      <td><p>Should the spatial weights matrix be forced to symmetry, default TRUE</p></td>
    </tr>
    <tr>
      <th>alpha</th>
      <td><p>if not NULL, used instead of the tol= argument as a stopping rule to choose all eigenvectors up to and including the one with a probability value exceeding alpha.</p></td>
    </tr>
    <tr>
      <th>alternative</th>
      <td><p>a character string specifying the alternative hypothesis, must be one of greater, less or two.sided (default).</p></td>
    </tr>
    <tr>
      <th>verbose</th>
      <td><p>default NULL, use global option value; if TRUE report eigenvectors selected</p></td>
    </tr>
    </table>
    
    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>An <code>SFResult</code> object, with:</p>
<dt>selection</dt><dd><p>a matrix summarising the selection of eigenvectors for inclusion, with columns:
    <dl class='dl-horizontal'>
      <dt>Step</dt><dd><p>Step counter of the selection procedure</p></dd>
      <dt>SelEvec</dt><dd><p>number of selected eigenvector (sorted descending)</p></dd>
      <dt>Eval</dt><dd><p>its associated eigenvalue</p></dd>
      <dt>MinMi</dt><dd><p>value Moran's I for residual autocorrelation</p></dd>
      <dt>ZMinMi</dt><dd><p>standardized value of Moran's I assuming a normal approximation</p></dd>
      <dt>pr(ZI)</dt><dd><p>probability value of the permutation-based standardized deviate for the given value of the alternative argument</p></dd>
      <dt>R2</dt><dd><p>R\^2 of the model including exogenous variables and eigenvectors</p></dd>
      <dt>gamma</dt><dd><p>regression coefficient of selected eigenvector in fit</p></dd>
    </dl>
    The first row is the value at the start of the search</p></dd>
  <dt>dataset</dt><dd><p>a matrix of the selected eigenvectors in order of selection</p></dd>

    
    <h2 class="hasAnchor" id="references"><a class="anchor" href="#references"></a>References</h2>

    <p>Tiefelsdorf M, Griffith DA. (2007) Semiparametric Filtering of Spatial Autocorrelation: The Eigenvector Approach. Environment and Planning A, 39 (5) 1193 - 1221.</p>
    
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p><code><a href='https://www.rdocumentation.org/packages/stats/topics/lm'>lm</a></code>, <code><a href='https://www.rdocumentation.org/packages/base/topics/eigen'>eigen</a></code>, <code><a href='nb2listw.html'>nb2listw</a></code>, <code><a href='lm.morantest.html'>listw2U</a></code></p></div>
    

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='kw'>if</span> (<span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/library'>require</a></span>(<span class='no'>rgdal</span>, <span class='kw'>quietly</span><span class='kw'>=</span><span class='fl'>TRUE</span>)) {
<span class='fu'><a href='https://www.rdocumentation.org/packages/utils/topics/example'>example</a></span>(<span class='no'>columbus</span>, <span class='kw'>package</span><span class='kw'>=</span><span class='st'>"spData"</span>)
<span class='no'>lmbase</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/stats/topics/lm'>lm</a></span>(<span class='no'>CRIME</span> ~ <span class='no'>INC</span> + <span class='no'>HOVAL</span>, <span class='kw'>data</span><span class='kw'>=</span><span class='no'>columbus</span>)
<span class='no'>sarcol</span> <span class='kw'>&lt;-</span> <span class='fu'>SpatialFiltering</span>(<span class='no'>CRIME</span> ~ <span class='no'>INC</span> + <span class='no'>HOVAL</span>, <span class='kw'>data</span><span class='kw'>=</span><span class='no'>columbus</span>,
 <span class='kw'>nb</span><span class='kw'>=</span><span class='no'>col.gal.nb</span>, <span class='kw'>style</span><span class='kw'>=</span><span class='st'>"W"</span>, <span class='kw'>ExactEV</span><span class='kw'>=</span><span class='fl'>TRUE</span>)
<span class='no'>sarcol</span>
<span class='no'>lmsar</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/stats/topics/lm'>lm</a></span>(<span class='no'>CRIME</span> ~ <span class='no'>INC</span> + <span class='no'>HOVAL</span> + <span class='fu'><a href='https://www.rdocumentation.org/packages/stats/topics/fitted.values'>fitted</a></span>(<span class='no'>sarcol</span>), <span class='kw'>data</span><span class='kw'>=</span><span class='no'>columbus</span>)
<span class='no'>lmsar</span>
<span class='fu'><a href='https://www.rdocumentation.org/packages/stats/topics/anova'>anova</a></span>(<span class='no'>lmbase</span>, <span class='no'>lmsar</span>)
<span class='fu'><a href='lm.morantest.html'>lm.morantest</a></span>(<span class='no'>lmsar</span>, <span class='fu'><a href='nb2listw.html'>nb2listw</a></span>(<span class='no'>col.gal.nb</span>))
<span class='no'>lagcol</span> <span class='kw'>&lt;-</span> <span class='fu'>SpatialFiltering</span>(<span class='no'>CRIME</span> ~ <span class='fl'>1</span>, ~ <span class='no'>INC</span> + <span class='no'>HOVAL</span> - <span class='fl'>1</span>, <span class='kw'>data</span><span class='kw'>=</span><span class='no'>columbus</span>,
 <span class='kw'>nb</span><span class='kw'>=</span><span class='no'>col.gal.nb</span>, <span class='kw'>style</span><span class='kw'>=</span><span class='st'>"W"</span>)
<span class='no'>lagcol</span>
<span class='no'>lmlag</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/stats/topics/lm'>lm</a></span>(<span class='no'>CRIME</span> ~ <span class='no'>INC</span> + <span class='no'>HOVAL</span> + <span class='fu'><a href='https://www.rdocumentation.org/packages/stats/topics/fitted.values'>fitted</a></span>(<span class='no'>lagcol</span>), <span class='kw'>data</span><span class='kw'>=</span><span class='no'>columbus</span>)
<span class='no'>lmlag</span>
<span class='fu'><a href='https://www.rdocumentation.org/packages/stats/topics/anova'>anova</a></span>(<span class='no'>lmbase</span>, <span class='no'>lmlag</span>)
<span class='fu'><a href='lm.morantest.html'>lm.morantest</a></span>(<span class='no'>lmlag</span>, <span class='fu'><a href='nb2listw.html'>nb2listw</a></span>(<span class='no'>col.gal.nb</span>))
}</div><div class='output co'>#&gt; 
#&gt; colmbs&gt; if (requireNamespace("rgdal", quietly = TRUE)) {
#&gt; colmbs+   library(rgdal)
#&gt; colmbs+   columbus &lt;- readOGR(system.file("shapes/columbus.shp", package="spData")[1])
#&gt; colmbs+   plot(columbus)
#&gt; colmbs+ }
#&gt; OGR data source with driver: ESRI Shapefile 
#&gt; Source: "/home/rsb/lib/r_libs/spData/shapes/columbus.shp", layer: "columbus"
#&gt; with 49 features
#&gt; It has 20 fields
#&gt; Integer64 fields read as strings:  COLUMBUS_ COLUMBUS_I POLYID </div><div class='img'><img src='SpatialFiltering-1.png' alt='' width='700' height='433' /></div><div class='output co'>#&gt; 
#&gt; colmbs&gt; if (requireNamespace("spdep", quietly = TRUE)) {
#&gt; colmbs+   library(spdep)
#&gt; colmbs+   col.gal.nb &lt;- read.gal(system.file("weights/columbus.gal", package="spData")[1])
#&gt; colmbs+ }</div><div class='output co'>#&gt; 
#&gt; 	Global Moran I for regression residuals
#&gt; 
#&gt; data:  
#&gt; model: lm(formula = CRIME ~ INC + HOVAL + fitted(lagcol), data =
#&gt; columbus)
#&gt; weights: nb2listw(col.gal.nb)
#&gt; 
#&gt; Moran I statistic standard deviate = -0.048565, p-value = 0.5194
#&gt; alternative hypothesis: greater
#&gt; sample estimates:
#&gt; Observed Moran I      Expectation         Variance 
#&gt;     -0.220179195     -0.217083975      0.004061888 
#&gt; </div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#arguments">Arguments</a></li>
      
      <li><a href="#value">Value</a></li>

      <li><a href="#references">References</a></li>

      <li><a href="#see-also">See also</a></li>
      
      <li><a href="#examples">Examples</a></li>
    </ul>

    <h2>Author</h2>
    <p>Yongwan Chun, Michael Tiefelsdorf, Roger Bivand</p>
  </div>
</div>

      <footer>
      <div class="copyright">
  <p>Developed by Roger Bivand.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
   </div>

  

  </body>
</html>

