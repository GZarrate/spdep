<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Moran Eigenvectors • spdep</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Moran Eigenvectors">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">spdep</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.0.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/CO69.html">“The Problem of Spatial Autocorrelation:” forty years on</a>
    </li>
    <li>
      <a href="../articles/SpatialFiltering.html">Moran Eigenvectors</a>
    </li>
    <li>
      <a href="../articles/nb_igraph.html">Spatial weights objects as sparse matrices and graphs</a>
    </li>
    <li>
      <a href="../articles/nb_sf.html">Creating Neighbours using sf objects</a>
    </li>
    <li>
      <a href="../articles/sids.html">Introduction to the North Carolina SIDS data set (revised)</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/r-spatial/spdep">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Moran Eigenvectors</h1>
                        <h4 class="author">Roger Bivand</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/r-spatial/spdep/blob/master/vignettes/SpatialFiltering.Rmd"><code>vignettes/SpatialFiltering.Rmd</code></a></small>
      <div class="hidden name"><code>SpatialFiltering.Rmd</code></div>

    </div>

    
    
<div id="introduction" class="section level2">
<h2 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h2>
<p>The Moran eigenvector approach <span class="citation">(Dray, Legendre, and Peres-Neto 2006; Griffith and Peres-Neto 2006)</span> involved the spatial patterns represented by maps of eigenvectors; by choosing suitable orthogonal patterns and adding them to a linear or generalised linear model, the spatial dependence present in the residuals can be moved into the model.</p>
<p>It uses brute force to search the set of eigenvectors of the matrix <span class="math inline">\(\mathbf{M W M}\)</span>, where</p>
<p><span class="math display">\[\mathbf{M} = \mathbf{I} - \mathbf{X}(\mathbf{X}^{\rm T}
\mathbf{X})^{-1}\mathbf{X}^{\rm T}\]</span> is a symmetric and idempotent projection matrix and <span class="math inline">\(\mathbf{W}\)</span> are the spatial weights. In the spatial lag form of <span><code>SpatialFiltering</code></span> and in the GLM <span><code>ME</code></span> form below, <span class="math inline">\(\mathbf{X}\)</span> is an <span class="math inline">\(n\)</span>-vector of ones, that is the intercept only.</p>
<p>In its general form, <span><code>SpatialFiltering</code></span> chooses the subset of the <span class="math inline">\(n\)</span> eigenvectors that reduce the residual spatial autocorrelation in the error of the model with covariates. The lag form adds the covariates in assessment of which eigenvectors to choose, but does not use them in constructing the eigenvectors. <span><code>SpatialFiltering</code></span> was implemented and contributed by Yongwan Chun and Michael Tiefelsdorf, and is presented in <span class="citation">Tiefelsdorf and Griffith (2007)</span>; <span><code>ME</code></span> is based on Matlab code by Pedro Peres-Neto and is discussed in <span class="citation">Dray, Legendre, and Peres-Neto (2006)</span> and <span class="citation">Griffith and Peres-Neto (2006)</span>.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(spdep)</a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="cf">if</span> (<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">require</a></span>(rgdal, <span class="dt">quietly=</span><span class="ot">TRUE</span>)) {</a>
<a class="sourceLine" id="cb1-3" data-line-number="3">  NY8 &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/rgdal/topics/readOGR">readOGR</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/system.file">system.file</a></span>(<span class="st">"shapes/NY8_utm18.shp"</span>, <span class="dt">package=</span><span class="st">"spData"</span>))</a>
<a class="sourceLine" id="cb1-4" data-line-number="4">} <span class="cf">else</span> {</a>
<a class="sourceLine" id="cb1-5" data-line-number="5">  <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">require</a></span>(maptools, <span class="dt">quietly=</span><span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb1-6" data-line-number="6">  NY8 &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/maptools/topics/readShapeSpatial">readShapeSpatial</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/system.file">system.file</a></span>(<span class="st">"shapes/NY8_utm18.shp"</span>, <span class="dt">package=</span><span class="st">"spData"</span>))</a>
<a class="sourceLine" id="cb1-7" data-line-number="7">}</a></code></pre></div>
<pre><code>## OGR data source with driver: ESRI Shapefile 
## Source: "/home/rsb/lib/r_libs/spData/shapes/NY8_utm18.shp", layer: "NY8_utm18"
## with 281 features
## It has 17 fields</code></pre>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1">NY_nb &lt;-<span class="st"> </span><span class="kw"><a href="../reference/read.gal.html">read.gal</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/system.file">system.file</a></span>(<span class="st">"weights/NY_nb.gal"</span>, <span class="dt">package=</span><span class="st">"spData"</span>), <span class="dt">region.id=</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/row.names">row.names</a></span>(NY8))</a></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1">nySFE &lt;-<span class="st"> </span><span class="kw"><a href="../reference/SpatialFiltering.html">SpatialFiltering</a></span>(Z<span class="op">~</span>PEXPOSURE<span class="op">+</span>PCTAGE65P<span class="op">+</span>PCTOWNHOME, <span class="dt">data=</span>NY8, <span class="dt">nb=</span>NY_nb, <span class="dt">style=</span><span class="st">"W"</span>, <span class="dt">verbose=</span><span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb4-2" data-line-number="2">nylmSFE &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/lm">lm</a></span>(Z<span class="op">~</span>PEXPOSURE<span class="op">+</span>PCTAGE65P<span class="op">+</span>PCTOWNHOME<span class="op">+</span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/fitted.values">fitted</a></span>(nySFE), <span class="dt">data=</span>NY8)</a>
<a class="sourceLine" id="cb4-3" data-line-number="3"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/summary">summary</a></span>(nylmSFE)</a></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = Z ~ PEXPOSURE + PCTAGE65P + PCTOWNHOME + fitted(nySFE), 
##     data = NY8)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -1.5184 -0.3523 -0.0105  0.3221  3.1964 
## 
## Coefficients:
##                    Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)        -0.51728    0.14606  -3.542 0.000469 ***
## PEXPOSURE           0.04884    0.03230   1.512 0.131717    
## PCTAGE65P           3.95089    0.55776   7.083 1.25e-11 ***
## PCTOWNHOME         -0.56004    0.15688  -3.570 0.000423 ***
## fitted(nySFE)vec13 -2.09397    0.60534  -3.459 0.000630 ***
## fitted(nySFE)vec44 -2.24003    0.60534  -3.700 0.000261 ***
## fitted(nySFE)vec6   1.02979    0.60534   1.701 0.090072 .  
## fitted(nySFE)vec38  1.29282    0.60534   2.136 0.033613 *  
## fitted(nySFE)vec20  1.10064    0.60534   1.818 0.070150 .  
## fitted(nySFE)vec14 -1.05105    0.60534  -1.736 0.083662 .  
## fitted(nySFE)vec75  1.90600    0.60534   3.149 0.001826 ** 
## fitted(nySFE)vec21 -1.06331    0.60534  -1.757 0.080138 .  
## fitted(nySFE)vec36 -1.17861    0.60534  -1.947 0.052578 .  
## fitted(nySFE)vec61 -1.08582    0.60534  -1.794 0.073986 .  
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard error: 0.6053 on 267 degrees of freedom
## Multiple R-squared:  0.3401, Adjusted R-squared:  0.308 
## F-statistic: 10.58 on 13 and 267 DF,  p-value: &lt; 2.2e-16</code></pre>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1">nylm &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/lm">lm</a></span>(Z<span class="op">~</span>PEXPOSURE<span class="op">+</span>PCTAGE65P<span class="op">+</span>PCTOWNHOME, <span class="dt">data=</span>NY8)</a>
<a class="sourceLine" id="cb6-2" data-line-number="2"><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/anova">anova</a></span>(nylm, nylmSFE)</a></code></pre></div>
<pre><code>## Analysis of Variance Table
## 
## Model 1: Z ~ PEXPOSURE + PCTAGE65P + PCTOWNHOME
## Model 2: Z ~ PEXPOSURE + PCTAGE65P + PCTOWNHOME + fitted(nySFE)
##   Res.Df     RSS Df Sum of Sq      F    Pr(&gt;F)    
## 1    277 119.619                                  
## 2    267  97.837 10    21.782 5.9444 3.988e-08 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
<p>Since the <span><code>SpatialFiltering</code></span> approach does not allow weights to be used, we see that the residual autocorrelation of the original linear model is absorbed, or ‘whitened’ by the inclusion of selected eigenvectors in the model, but that the covariate coefficients change little. The addition of these eigenvectors – each representing an independent spatial pattern – relieves the residual autocorrelation, but otherwise makes few changes in the substantive coefficient values.</p>
<p>The <span><code>ME</code></span> function also searches for eigenvectors from the spatial lag variant of the underlying model, but in a GLM framework. The criterion is a permutation bootstrap test on Moran’s <span class="math inline">\(I\)</span> for regression residuals, and in this case, because of the very limited remaining spatial autocorrelation, is set at <span class="math inline">\(\alpha = 0.5\)</span>. Even with this very generous stopping rule, only few eigenvectors are chosen; their combined contribution only just improves the fit of the GLM model.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1">NYlistwW &lt;-<span class="st"> </span><span class="kw"><a href="../reference/nb2listw.html">nb2listw</a></span>(NY_nb, <span class="dt">style =</span> <span class="st">"W"</span>)</a>
<a class="sourceLine" id="cb8-2" data-line-number="2"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Random">set.seed</a></span>(<span class="dv">111</span>)</a></code></pre></div>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1">nyME &lt;-<span class="st"> </span><span class="kw"><a href="../reference/ME.html">ME</a></span>(Cases<span class="op">~</span>PEXPOSURE<span class="op">+</span>PCTAGE65P<span class="op">+</span>PCTOWNHOME, <span class="dt">data=</span>NY8, <span class="dt">offset=</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Log">log</a></span>(POP8), <span class="dt">family=</span><span class="st">"poisson"</span>, <span class="dt">listw=</span>NYlistwW, <span class="dt">alpha=</span><span class="fl">0.5</span>)</a></code></pre></div>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1">nyME</a>
<a class="sourceLine" id="cb10-2" data-line-number="2">NY8<span class="op">$</span>eigen_<span class="dv">24</span> &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/fitted.values">fitted</a></span>(nyME)[,<span class="dv">1</span>]</a>
<a class="sourceLine" id="cb10-3" data-line-number="3">NY8<span class="op">$</span>eigen_<span class="dv">223</span> &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/fitted.values">fitted</a></span>(nyME)[,<span class="dv">2</span>]</a></code></pre></div>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1">nyglmME &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/glm">glm</a></span>(Cases<span class="op">~</span>PEXPOSURE<span class="op">+</span>PCTAGE65P<span class="op">+</span>PCTOWNHOME<span class="op">+</span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/offset">offset</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Log">log</a></span>(POP8))<span class="op">+</span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/fitted.values">fitted</a></span>(nyME), <span class="dt">data=</span>NY8, <span class="dt">family=</span><span class="st">"poisson"</span>)</a>
<a class="sourceLine" id="cb11-2" data-line-number="2"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/summary">summary</a></span>(nyglmME)</a>
<a class="sourceLine" id="cb11-3" data-line-number="3">nyGLMp &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/glm">glm</a></span>(Cases<span class="op">~</span>PEXPOSURE<span class="op">+</span>PCTAGE65P<span class="op">+</span>PCTOWNHOME<span class="op">+</span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/offset">offset</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Log">log</a></span>(POP8)), <span class="dt">data=</span>NY8,<span class="dt">family=</span><span class="st">"poisson"</span>)</a>
<a class="sourceLine" id="cb11-4" data-line-number="4"><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/anova">anova</a></span>(nyGLMp, nyglmME, <span class="dt">test=</span><span class="st">"Chisq"</span>)</a></code></pre></div>
<p>Figure <span class="math display">\[fig:geigen2\]</span> shows the spatial patterns chosen to match the very small amount of spatial autocorrelation remaining in the model. As with the other Poisson regressions, the closeness to TCE sites is highly significant. Since, however, many TCE sites are also in or close to more densely populated urban areas with the possible presence of both point-source and non-point-source pollution, it would be premature to take such results simply at their face value. There is, however, a potentially useful contrast between the cities of Binghampton in the south of the study area with several sites in its vicinity, and Syracuse in the north without TCE sites in this data set.</p>
</div>
<div id="references" class="section level2 unnumbered">
<h2 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h2>
<div id="refs" class="references">
<div id="ref-dray+legendre+peres-neto:06">
<p>Dray, S., P. Legendre, and P. R. Peres-Neto. 2006. “Spatial Modeling: A Comprehensive Framework for Principle Coordinate Analysis of Neighbor Matrices (PCNM).” <em>Ecological Modelling</em> 196: 483–93.</p>
</div>
<div id="ref-griffith+peres-neto:06">
<p>Griffith, D. A., and P. R. Peres-Neto. 2006. “Spatial Modeling in Ecology: The Flexibility of Eigenfunction Spatial Analyses.” <em>Ecology</em> 87: 2603–13.</p>
</div>
<div id="ref-tiefelsdorf+griffith:07">
<p>Tiefelsdorf, M., and D. A. Griffith. 2007. “Semiparametric Filtering of Spatial Autocorrelation: The Eigenvector Approach.” <em>Environment and Planning A</em> 39: 1193–1221.</p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#introduction">Introduction</a></li>
      <li><a href="#references">References</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Roger Bivand.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
</div>

  

  </body>
</html>
